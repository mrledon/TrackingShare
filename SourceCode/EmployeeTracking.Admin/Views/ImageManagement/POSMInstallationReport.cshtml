
@{
    ViewBag.Title = "POSMInstallationReport";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section CSS
{
    <link href="~/Assets/plugins/dropzone/min/dropzone.min.css" rel="stylesheet" />
    <link href="~/Assets/plugins/Datetime-Picker-jQuery-Moment/css/datetimepicker.css" rel="stylesheet" />
    <style>
        .posm-item {
            position: relative;
            display: inline-block;
            float: left;
            margin-left: 10px;
            margin-top: 20px;
            width: 150px;
            height: 150px;
        }

            .posm-item img {
                position: absolute;
                width: 100%;
                height: 100%;
            }

            .posm-item .posm-text {
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
            }

            .posm-item .posm-btn-remove {
                position: absolute;
                top: -5px;
                right: -5px;
                width: 1.2em;
                height: 1.2em;
                z-index: 1000;
                font-size: 1.2em !important;
                line-height: 1em;
                text-align: center;
                font-weight: bold;
                border: 1px solid gray !important;
                border-radius: 1.2em;
                color: red;
                background-color: white;
                opacity: .5;
                cursor: pointer;
            }

                .posm-item .posm-btn-remove:hover {
                    text-decoration: none !important;
                    opacity: 1;
                }

            .posm-item .posm-text span {
                color: white;
                font: bold 14px/45px Helvetica, Sans-Serif;
                letter-spacing: -1px;
                background: rgb(0, 0, 0); /* fallback color */
                background: rgba(0, 0, 0, 0.7);
                padding: 5px;
            }
    </style>

}
<h2>Báo cáo lắp đặt POSM</h2>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-8">
        <div class="box box-default">
            <div class="box-header with-border">
                <h3 class="box-title">Chọn ngày thực hiện</h3>
            </div>
            <div class="box-body">
                <div class="form-group">

                    <div id="picker"> </div>
                    <input type="hidden" id="result" value="">
                </div>
            </div>
        </div>
        <div class="box box-default">
            <div class="box-header with-border">
                <h3 class="box-title">Thêm ảnh cửa hàng</h3>
            </div>
            <div class="box-body">
                <div class="col-xs-3">
                    <div class="form-group">
                        <h4>Hình tổng quan</h4>
                        <div class="posm-item">
                            <a class="posm-btn-remove" data-type="DEFAULT" data-sub-type="GENERAL" data-img="noimage.png"><i class="fa fa-remove"></i></a>
                            <img class="changeImageDefault" src="~/Content/Images/noimage.png" data-type="DEFAULT" data-sub-type="GENERAL" data-img="noimage.png" />
                        </div>
                    </div>
                </div>
                <div class="col-xs-3">
                    <div class="form-group">
                        <h4>Hình địa chỉ</h4>
                        <div class="posm-item">
                            <a class="posm-btn-remove" data-type="DEFAULT" data-sub-type="ADDRESS" data-img="noimage.png"><i class="fa fa-remove"></i></a>
                            <img class="changeImageDefault" src="~/Content/Images/noimage.png" data-type="DEFAULT" data-sub-type="ADDRESS" data-img="noimage.png" />
                        </div>
                    </div>
                </div>
                <div class="col-xs-3">
                    <div class="form-group">
                        <h4>Hình chấm công</h4>
                        <div class="posm-item">
                            <a class="posm-btn-remove" data-type="SELFIE" data-sub-type="" data-img="noimage.png"><i class="fa fa-remove"></i></a>
                            <img class="changeImageDefault" src="~/Content/Images/noimage.png" data-type="SELFIE" data-sub-type="" data-img="noimage.png" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="box box-default">
            <div class="box-header with-border">
                <h3 class="box-title">Thêm ảnh cửa hàng không thành công</h3>
                <a class="btn btn-success btn-xs pull-right addStoreFailBtn"><i class="fa fa-pencil"></i> Thêm ảnh</a>
                <div style="display: none;">
                    <input type="file" id="uploadFile" name="uploadFile" hidden onchange="ValidateFile(this);" />
                </div>
            </div>
            <div class="box-body">
                <div class="col-xs-3">
                    <div class="form-group" id="storeDiv">
                        <div class="posm-item">
                            <a class="posm-btn-remove" data-type="STORE" data-sub-type="" data-img="noimage.png"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/noimage.png" />
                        </div>
                        <div class="posm-item">
                            <a class="posm-btn-remove" data-type="STORE" data-sub-type="" data-img="noimage.png"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/noimage.png" />
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="box box-default">
            <div class="box-header with-border">
                <h3 class="box-title">Ảnh POSM</h3>
            </div>
            <div class="box-body" style="max-height: 600px;overflow-y: scroll;">
                <div class="box box-solid">
                    <div class="box-header with-border">
                        <i class="fa fa-image"></i>
                        <h3 class="box-title">Banner 7Up Tết - <strong>Số lượng:</strong></h3>
                        <input type="number" min="0" style="color:black; font-weight:bold; width:40px!important;padding-left:1px!important;" />
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body" style="padding-bottom:30px;background:#F1F1F4;">
                        <div class="posm-item">
                            <a class="posm-btn-remove"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/meow-meow.jpg" />
                            <div class="posm-text"><span>Hình ký PXN</span></div>
                        </div>
                        <div class="posm-item">
                            <a class="posm-btn-remove"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/meow-meow.jpg" />
                            <div class="posm-text"><span>Hình PXN đầy đủ</span></div>
                        </div>
                        <div class="posm-item">
                            <a class="posm-btn-remove"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/meow-meow.jpg" />
                            <div class="posm-text"><span>Hình SPVB</span></div>
                        </div>
                        <div class="posm-item">
                            <a class="posm-btn-remove"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/meow-meow.jpg" />
                        </div>
                        <div class="posm-item">
                            <a class="posm-btn-remove"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/meow-meow.jpg" />
                        </div>
                    </div>
                    <!-- /.box-body -->
                </div>

                <div class="box box-solid">
                    <div class="box-header with-border">
                        <i class="fa fa-image"></i>
                        <h3 class="box-title">Banner  Oolong - <strong>Số lượng:</strong></h3>
                        <input type="number" min="0" style="color:black; font-weight:bold; width:40px!important;padding-left:1px!important;" />
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body" style="padding-bottom:30px;background:#F1F1F4;">
                        <div class="posm-item">
                            <a class="posm-btn-remove"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/meow-meow.jpg" />
                            <div class="posm-text"><span>Hình ký PXN</span></div>
                        </div>
                        <div class="posm-item">
                            <a class="posm-btn-remove"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/meow-meow.jpg" />
                            <div class="posm-text"><span>Hình PXN đầy đủ</span></div>
                        </div>
                        <div class="posm-item">
                            <a class="posm-btn-remove"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/meow-meow.jpg" />
                            <div class="posm-text"><span>Hình SPVB</span></div>
                        </div>
                        <div class="posm-item">
                            <a class="posm-btn-remove"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/meow-meow.jpg" />
                        </div>
                        <div class="posm-item">
                            <a class="posm-btn-remove"><i class="fa fa-remove"></i></a>
                            <img src="~/Content/Images/meow-meow.jpg" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="box box-solid">
            <div class="box-body">
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label>Loại POSM</label>
                            <select class="form-control" id="posmType" name="posmType"></select>
                        </div>
                        <div class="form-group">
                            <label>Loại hình ảnh</label>
                            <select class="form-control">
                                <option value="HINH_KY_PXN">Hình Ký PXN</option>
                                <option value="HINH_PXN_FULL">Hình PXN đầy đủ</option>
                                <option value="HINH_SPVB">Hình SPVB</option>
                                <option value="">Ảnh khác</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-8">
                        <div class="form-group">
                            <form action="/" id="frmFileUpload" class="dropzone" method="post" enctype="multipart/form-data">
                                <div class="dz-message">
                                    <div class="drag-icon-cph">
                                        <img src="~/Content/Images/Network-Upload-icon.png" />
                                    </div>

                                    <h3>Thả tập tin ở đây hoặc nhấp để tải lên.</h3>
                                    <em>(Tải lên tối đa 5 hình cùng lúc. Mỗi hình không quá 4MB)</em>
                                </div>
                                <div class="fallback">
                                    <input name="file" type="file" multiple />

                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box-footer">
                <a class="btn btn-xs btn-block btn-info"><i class="fa fa-picture-o"></i> Thêm ảnh</a>
            </div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-4">
        <div class="box box-primary">
            <div class="box-header with-border">
                <h3 class="box-title">Thông tin Cửa Hàng</h3>
            </div>
            <form role="form">
                <div class="box-body">
                    <div class="form-group">
                        <label>Mã cửa hàng</label>
                        <div class="input-group input-group-sm">
                            <input id="code" name="code" type="text" class="form-control" placeholder="Nhập mã cửa hàng">
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-info btn-flat findStoreBtn" onclick="findStore();">Tìm CH!</button>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Tên cửa hàng</label>
                        <input id="name" name="name" type="text" class="form-control" placeholder="Nhập tên cửa hàng">
                    </div>
                    <div class="form-group">
                        <label>Số điện thoại</label>
                        <input id="phone" name="phone" type="text" class="form-control" placeholder="Nhập số điện thoại cửa hàng">
                    </div>
                    <div class="form-group">
                        <label>Số nhà</label>
                        <input id="houseNumber" name="houseNumber" type="text" class="form-control" placeholder="Nhập số nhà">
                    </div>
                    <div class="form-group">
                        <label>Tên đường</label>
                        <input id="streetName" name="streetName" type="text" class="form-control" placeholder="Nhập tên đường">
                    </div>
                    <div class="form-group">
                        <label>Tỉnh/Thành</label>
                        <select class="form-control" id="ddlProvinceId" name="ddlProvinceId"></select>
                    </div>
                    <div class="form-group">
                        <label>Quận/Huyện</label>
                        <select class="form-control" id="ddlDistrictId" name="ddlDistrictId"></select>
                    </div>
                    <div class="form-group">
                        <label>Phường/Xã</label>
                        <select class="form-control" id="ddlWardId" name="ddlWardId"></select>
                    </div>
                    <div class="form-group">
                        <label>Loại hình</label>
                        <select class="form-control" id="ddlStoreType" name="ddlStoreType"></select>
                    </div>
                    <div class="form-group">
                        <label>Tọa độ cửa hàng</label><br />
                        <strong>Kinh độ: <input id="longitude" name="longitude" type="text" class="form-control" /></strong><br />
                        <strong>Vĩ độ: <input id="latitude" name="latitude" type="text" class="form-control" /></strong>
                    </div>
                    <div class="form-group">
                        <label>Ghi chú</label>
                        <textarea id="notes" name="notes" rows="3" class="form-control" placeholder="Nhập ghi chú"></textarea>
                    </div>
                    <div class="checkbox">
                        <label>
                            <input id="success" type="checkbox"> Thành công
                        </label>
                        <label>
                            <input id="unSuccess" type="checkbox" checked> Không thành công
                        </label>
                    </div>
                </div>
                <div class="box-footer text-right">
                    <a class="btn btn-warning" href="@Url.Action("Index","ImageManagement")">Quay lại</a>
                    <button type="submit" class="btn btn-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section scripts{
    <script src="~/Assets/plugins/dropzone/min/dropzone.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.0/moment-with-locales.min.js"></script>
    <script src="~/Assets/plugins/Datetime-Picker-jQuery-Moment/js/datetimepicker.js"></script>
    <script>

        $(document).ready(function () {



        });
        
        function guid() {
            function s4() {
                return Math.floor((1 + Math.random()) * 0x10000)
                    .toString(16)
                    .substring(1);
            }
            return s4() + s4();
        }

        $('#picker').dateTimePicker({
            showTime: true,
            locale: 'vi',
            buttonTitle: "Áp dụng",
            onChangeDateTime: function (dp, $input) {
                alert($input.val())
            }
        });

        Dropzone.options.frmFileUpload = {
            paramName: "file",
            maxFilesize: 5,
            acceptedFiles: "image/*",
            addRemoveLinks: true,
            dictRemoveFile: "Xóa ảnh"
        };

        function findStore() {
            var day = $('#picker > span').html();
            var time = $('#picker > span').next().next().html();
            provinceId = '';
            districtId = '';
            wardId = '';
            if ($('#code').val().length > 0) {
                var url = '@Url.Action("FindStore", "StoreManager")' + '?code=' + $('#code').val();
                $.get({
                    url: url,
                    type: 'get',
                    contentType: 'application/json',
                    success: function (response) {
                        if (response != null) {
                            provinceId = response.ProvinceId;
                            districtId = response.DistrictId;
                            wardId = response.WardId;
                            $('#name').val(response.Name);
                            $('#phone').val(response.PhoneNumber);
                            $('#houseNumber').val(response.HouseNumber);
                            $('#streetName').val(response.StreetNames);
                            $('#ddlProvinceId').val(response.ProvinceId);
                            provinceChange();
                            $('#ddlDistrictId').val(response.DistrictId);
                            $('#ddlWardId').val(response.WardId);
                            $('#ddlStoreType').val(response.StoreType);
                            $('#longitude').val(response.LNG);
                            $('#latitude').val(response.LAT);
                            $('#notes').val('');
                        }
                    }
                })
            }
        }

        $(document).on('click', '#success', function (e) {
            if ($(this).prop('checked') === true) {
                $('#unSuccess').prop('checked', false);
            } else {
                $('#unSuccess').prop('checked', true);
            }
        });

        $(document).on('click', '#unSuccess', function (e) {
            if ($(this).prop('checked') === true) {
                $('#success').prop('checked', false);
            } else {
                $('#success').prop('checked', true);
            }
        });

    </script>
    <!--Form load-->
    <script>

        var provinceId = '';
        var districtId = '';
        var wardId = '';

        $(document).ready(function () {
            LoadMediaType();
            loadStoreType();
            loadProvince();

            $('#ddlProvinceId').change(function () {
                $('#ddlDistrictId').empty();
                $('#ddlWardId').empty();
                provinceChange();
            });

            $('#ddlDistrictId').change(function () {
                $('#ddlWardId').empty();
                districtChange();
            });
        });

        function LoadMediaType() {
            $.ajax({
                url: '@Url.Action("MediaType", "ImageManagement")',
                type: "GET",
                contentType: "application/json; charset=utf-8",
                datatype: JSON,
                success: function (result) {
                    $("#posmType").empty();
                    $(result).each(function () {
                        $("#posmType").append($("<option></option>").val(this.Code).html(this.Name));
                    });
                },
                error: function (data) { }
            });
        }

        function loadStoreType() {
            $.ajax({
                url: '@Url.Action("GetStoreTypeSelect", "StoreManager")',
                type: "GET",
                contentType: "application/json; charset=utf-8",
                datatype: JSON,
                success: function (result) {
                    $("#ddlStoreType").append($("<option></option>").val("").html("-- Chọn loại cửa hàng --"));
                    $(result).each(function () {
                        if (provinceId != "" && this.Id == provinceId) {
                            $("#ddlStoreType").append($("<option selected></option>").val(this.Id).html(this.Name));
                        }
                        else {
                            $("#ddlStoreType").append($("<option></option>").val(this.Id).html(this.Name));
                        }
                    });
                },
                error: function (data) { }
            });
        }

        function loadProvince() {
            $.ajax({
                url: '@Url.Action("GetProvinceSelect", "Location")',
                type: "GET",
                contentType: "application/json; charset=utf-8",
                datatype: JSON,
                success: function (result) {
                    $("#ddlProvinceId").empty();
                    $("#ddlProvinceId").append($("<option></option>").val("").html("-- Chọn Tỉnh/Thành Phố --"));
                    $(result).each(function () {
                        if (provinceId != "" && this.Id == provinceId) {
                            $("#ddlProvinceId").append($("<option selected></option>").val(this.Id).html(this.Name));
                        }
                        else {
                            $("#ddlProvinceId").append($("<option></option>").val(this.Id).html(this.Name));
                        }
                    });
                },
                error: function (data) { }
            });
        }

        function provinceChange() {
            if ($("#ddlProvinceId").val() == null || $("#ddlProvinceId").val() == "") {
                $.ajax({
                    url: '@Url.Action("GetDistrictSelect", "Location")',
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    datatype: JSON,
                    async: false,
                    data: { provinceId: "@ViewBag.ProvinceId" },
                    success: function (result) {
                        $("#ddlDistrictId").empty();
                        $("#ddlDistrictId").append($("<option></option>").val("").html("-- Chọn Quận/Huyện --"));
                        $(result).each(function () {
                            if (districtId != "" && this.Id == districtId) {
                                $("#ddlDistrictId").append($("<option selected></option>").val(this.Id).html(this.Name));
                                districtChange();
                            }
                            else {
                                $("#ddlDistrictId").append($("<option></option>").val(this.Id).html(this.Name));
                            }
                        });
                    },
                    error: function (data) { }
                });
            }
            else if ($("#ddlProvinceId").val() != null && $("#ddlProvinceId").val() != "") {
                $.ajax({
                    url: '@Url.Action("GetDistrictSelect", "Location")',
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    datatype: JSON,
                    async: false,
                    data: { provinceId: $("#ddlProvinceId").val() },
                    success: function (result) {
                        $("#ddlDistrictId").empty();
                        $("#ddlDistrictId").append($("<option></option>").val("").html("-- Chọn Quận/Huyện --"));
                        $(result).each(function () {
                            if (districtId != "" && this.Id == districtId) {
                                $("#ddlDistrictId").append($("<option selected></option>").val(this.Id).html(this.Name));
                                districtChange();
                            }
                            else {
                                $("#ddlDistrictId").append($("<option></option>").val(this.Id).html(this.Name));
                            }
                        });
                    },
                    error: function (data) { }
                });
            }
        }

        function districtChange() {
            if ($("#ddlDistrictId").val() == null || $("#ddlDistrictId").val() == "") {
                $.ajax({
                    url: '@Url.Action("GetWardSelect", "Location")',
                    //url: "/Location/GetWardSelect",
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    datatype: JSON,
                    async: false,
                    data: { districtId: "@ViewBag.DistrictId" },
                    success: function (result) {
                        $("#ddlWardId").empty();
                        $("#ddlWardId").append($("<option></option>").val("").html("-- Chọn Phường/Xã --"));
                        $(result).each(function () {
                            if (wardId != "" && this.Id == wardId) {
                                $("#ddlWardId").append($("<option selected></option>").val(this.Id).html(this.Name));
                            }
                            else {
                                $("#ddlWardId").append($("<option></option>").val(this.Id).html(this.Name));
                            }
                        });
                    },
                    error: function (data) { }
                });
            }
            else if ($("#ddlDistrictId").val() != null && $("#ddlDistrictId").val() != "") {
                $.ajax({
                    url: '@Url.Action("GetWardSelect", "Location")',
                    //url: "/Location/GetWardSelect",
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    datatype: JSON,
                    async: false,
                    data: { districtId: $("#ddlDistrictId").val() },
                    success: function (result) {
                        $("#ddlWardId").empty();
                        $("#ddlWardId").append($("<option></option>").val("").html("-- Chọn Phường/Xã --"));
                        $(result).each(function () {
                            if (wardId != "" && this.Id == wardId) {
                                $("#ddlWardId").append($("<option selected></option>").val(this.Id).html(this.Name));
                            }
                            else {
                                $("#ddlWardId").append($("<option></option>").val(this.Id).html(this.Name));
                            }
                        });
                    },
                    error: function (data) { }
                });
            }
        }

    </script>
    <!--Image-->
    <script>
        var type = "";
        var subType = "";
        var fileName = "";
        var img = null;
        $(document).on('click', 'img.changeImageDefault', function (e) {
            img = $(this);
            type = $(this).attr('data-type');
            subType = $(this).attr('data-sub-type');
            fileName = $(this).attr('data-img');
            $('#uploadFile').click();
        });

        $(document).on('click', '.posm-btn-remove', function (e) {
            type = $(this).attr('data-type');
            subType = $(this).attr('data-sub-type');
            fileName = $(this).attr('data-img');
            img = $(this);
            if (type === "STORE") {
                $(this).parent().remove();
            } else {
                $(this).attr('data-img', '');
                $(this).next().attr('src', '/Content/Images/noimage.png');
            }
            var url = '@Url.Action("POSMDeleteImage", "ImageManagement")';
            var form = new FormData();
            var request = new XMLHttpRequest();
            form.set('type', type);
            form.set('subType', subType);
            form.set('fileName', fileName);
            request.open('POST', url);
            request.send(form);
        });

        $(document).on('click', 'a.addStoreFailBtn', function (e) {
            type = 'STORE';
            subType = '';
            img = null;
            fileName = '';
            $('#uploadFile').click();
        });

        function ValidateFileSize(fileid) {
            try {
                var fileSize = 0;
                if (navigator.userAgent.match(/msie/i)) {
                    var obaxo = new ActiveXObject("Scripting.FileSystemObject");
                    var filePath = $("#" + fileid)[0].value;
                    var objFile = obaxo.getFile(filePath);
                    var fileSize = objFile.size;
                    fileSize = fileSize / 1048576;
                }
                else {
                    fileSize = $(fileid)[0].files[0].size
                    fileSize = fileSize / 1048576;
                }

                return fileSize;
            }
            catch (e) {
                alert("Error is :" + e);
            }
        }

        function getNameFromPath(strFilepath) {
            var objRE = new RegExp(/([^\/\\]+)$/);
            var strName = objRE.exec(strFilepath);

            if (strName == null) {
                return null;
            }
            else {
                return strName[0];
            }
        }

        function loadImageReview(value, newFileName) {
            var filerd = new FileReader();
            $(img).attr('data-img', '');
            $(img).prev().attr('data-img', '');
            filerd.onload = function (e) {
                $(img).attr('src', e.target.result);
                $(img).attr('data-img', newFileName);
                $(img).prev().attr('data-img', newFileName);
            };
            filerd.readAsDataURL(value.files[0]);
        }

        function ValidateFile(value) {
            var file = getNameFromPath($(value).val());
            var extension = file.substr((file.lastIndexOf('.') + 1)).toLowerCase();
            if (file != null) {
                switch (extension) {
                    case 'jpg':
                    case 'jpeg':
                    case 'png':
                        flag = true;
                        break;
                    default:
                        flag = false;
                }
            }

            if (flag == false) {
                openFunc.pushNotifyWarning("Bạn chỉ có thể chọn file có định dạng jpg, jpeg, png");
                return false;
            }
            else {
                var size = ValidateFileSize(value);
                var str = value.name;
                if (size > 1) {
                    openFunc.pushNotifyWarning("Bạn chỉ có thể upload file kích thước tối đa là 1 MB.");
                }
                else {
                    var newFileName = guid();
                    if (type === "STORE") {
                        $('#storeDiv').append('<div class="posm-item">\
                                                    <a class="posm-btn-remove" data-type="STORE" data-sub-type="" data-img="' + newFileName + '.' + extension + '" > <i class="fa fa-remove"></i></a>\
                                                    <img id="' + newFileName + '" src="~/Content/Images/noimage.png" />\
                                                </div >');
                        img = $('#' + newFileName);
                    }
                    loadImageReview(value, newFileName + '.' + extension);

                    var url = '@Url.Action("POSMUploadImage", "ImageManagement")';
                    var form = new FormData();
                    var request = new XMLHttpRequest();
                    form.set('file', value.files[0]);
                    form.set('type', type);
                    form.set('subType', subType);
                    form.set('fileName', fileName);
                    form.set('newFileName', newFileName + '.' + extension);
                    request.open('POST', url);
                    request.send(form);
                    //Clean old file
                    $('#uploadFile').val('');
                }
            }
        }
        function loadImageMultiReview(value, idImage) {
            var filerd = new FileReader();
            filerd.onload = function (e) {
                var divReview = $("#_div" + idImage);
                var img = $("<img />");
                img.attr("class", "imgMulti");
                img.attr("src", e.target.result);
                divReview.append(img);
            };
            filerd.readAsDataURL(value[0]);
        }

        function ValidateMultiFile(value) {

            var divReview = $("#_div" + value.name);

            if ($(value).hasClass('addMore') === false) {
                divReview.html("");
            }

            $(value.files).each(function () {
                var extension = this.name.substr((this.name.lastIndexOf('.') + 1)).toLowerCase();
                switch (extension) {
                    case 'jpg':
                    case 'jpeg':
                    case 'png':
                        flag = true;
                        break;
                    default:
                        flag = false;
                }

                if (flag == false) {
                    var str = value.name;
                    var data = "_val" + str;
                    $("#" + data).text("Bạn chỉ có thể chọn file có định dạng jpg, jpeg, png");
                    $("#" + value.name).val('');
                    return false;
                }
                else {
                    var size = ValidateFileSize(value);
                    var str = value.name;
                    //var res = str.split("-");
                    var data = "_val" + str;
                    if (size > 1) {
                        $("#" + data).text("Bạn chỉ có thể upload file kích thước tối đa là 1 MB.");
                        $("#" + value.name).val('');
                    }
                    else {
                        $("#" + data).text("");
                        loadImageMultiReview($(this), str);
                        divReview.show();

                        @*if ($(value).hasClass('addMore')) {
                            var url = '@Url.Action("UploadOtherImage", "ImageManagement")';
                            var form = new FormData();
                            var request = new XMLHttpRequest();
                            form.set('file', this);
                            form.set('folder', str);
                            request.open('POST', url);
                            request.send(form);
                        }*@
                    }
                }
            });
        }

    </script>
}