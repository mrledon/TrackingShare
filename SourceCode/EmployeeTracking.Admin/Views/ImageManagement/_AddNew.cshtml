@model EmployeeTracking.Data.ModelCustom.AddImageModel

<div class="modal-content">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Thêm hình ảnh mới</h4>
    </div>
@using (Html.BeginForm("AddNew_Submit", "ImageManagement", FormMethod.Post, new { id = "TheForm", enctype = "multipart/form-data" }))
{
    @Html.HiddenFor(m => Model.EmployeeId)
    @Html.HiddenFor(m => Model.MasterStoreId)
    @Html.HiddenFor(m => Model.TrackId)
    <div class="modal-body">
        <div class="row">
            <div class="col-xs-12">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="form-group">
                            <label>Ngày cập nhật</label>
                            @Html.TextBoxFor(m => Model.DateUpdate, "{0:dd/MM/yyyy}", new { @class = "form-control", @type = "date", @Value = @ViewBag.DateUpdate })
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="form-group">
                            <h3>Ảnh cửa hàng</h3>
                            <div class="form-group">
                                <label class="control-label">Hình tổng quát</label>
                                <span class="btn btn-info btn-file">
                                    <input type="file" id="DEFAULT-GENERAL" name="DEFAULT-GENERAL"
                                           onchange="ValidateFile(this);" />
                                </span>
                                <span style="color:Red" id="_valDEFAULT-GENERAL"></span>
                            </div>
                            <div class="form-group">
                                <label class="control-label">Hình địa chỉ</label>
                                <span class="btn btn-info btn-file">
                                    <input type="file" id="DEFAULT-ADDRESS" name="DEFAULT-ADDRESS"
                                           onchange="ValidateFile(this);" />
                                </span>
                                <span style="color:Red" id="_valDEFAULT-ADDRESS"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <hr />
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="form-group">
                            <h3>Ảnh chấm công</h3>
                            <div class="form-group">
                                <span class="btn btn-info btn-file">
                                    <input type="file" id="SELFIE" name="SELFIE"
                                           onchange="ValidateFile(this);" />
                                    <span style="color:Red" id="_valSELFIE"></span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <hr />
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="form-group">
                            <h3>Ảnh POSM</h3>
                            @for (int i = 0; i< Model.FileUploads.Count;i++)
                            {
                                @Html.HiddenFor(m => Model.FileUploads[i].TypeId)
                                @Html.HiddenFor(m => Model.FileUploads[i].TypeName)
                                <div class="form-group">
                                    <div class="col-xs-12">
                                        <h5>@Model.FileUploads[i].TypeName</h5>
                                        @Html.TextBoxFor(model => model.FileUploads[i].PosmNumber, new { @style = "float:right; width:100px;", @type = "number", @min = "0" })
                                    </div>
                                </div>
                                if (Model.FileUploads[i].TypeId.Contains("BANNER") || Model.FileUploads[i].TypeId.Contains("STICKER"))
                                {
                                    <div class="form-group">
                                        <label class="control-label">Hình ký PXN</label>
                                        <span class="btn btn-info btn-file">
                                            <input type="file" id="@Model.FileUploads[i].TypeId-PXN" name="@Model.FileUploads[i].TypeId-PXN"
                                                   onchange="ValidateFile(this);" />
                                        </span>
                                        <span style="color:Red" id="_val'@Model.FileUploads[i].TypeId'-PXN"></span>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label">Hình ký PXN đầy đủ</label>
                                        <span class="btn btn-info btn-file">
                                            <input type="file" id="@Model.FileUploads[i].TypeId-PXNFULL" name="@Model.FileUploads[i].TypeId-PXNFULL"
                                                   onchange="ValidateFile(this);" />
                                        </span>
                                        <span style="color:Red" id="_val'@Model.FileUploads[i].TypeId'-PXNFULL"></span>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label">Hình SPVB</label>
                                        <span class="btn btn-info btn-file">
                                            <input type="file" id="@Model.FileUploads[i].TypeId-SPVB" name="@Model.FileUploads[i].TypeId-SPVB"
                                                   onchange="ValidateFile(this);" />
                                        </span>
                                        <span style="color:Red" id="_val'@Model.FileUploads[i].TypeId'-SPVB"></span>
                                    </div>
                                }
                                <div class="form-group">
                                    <span class="btn btn-info btn-file">
                                        <input type="file" id="@Model.FileUploads[i].TypeId" name="@Model.FileUploads[i].TypeId" multiple
                                               onchange="ValidateFile(this);" />
                                    </span>
                                    <span style="color:Red" id="_val'@Model.FileUploads[i].TypeId'"></span>
                                </div>
                            }
                        </div>
                    </div>
                </div>
                <div class="row">
                    <hr />
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="form-group">
                            <h3>Không thành công</h3>
                            <div class="form-group">
                                <span class="btn btn-info btn-file">
                                    <input type="file" id="STORE-FAILED" name="STORE-FAILED" multiple
                                           onchange="ValidateFile(this);" />
                                </span>
                                <span style="color:Red" id="_valSTORE-FAILED"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <hr />
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="submit" class="btn btn-primary"><i class="fa fa-download"></i> Lưu lại</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
    </div>
}
</div>
<script>
    function ValidateFileSize(fileid) {
        try {
            var fileSize = 0;
            if (navigator.userAgent.match(/msie/i)) {
                var obaxo = new ActiveXObject("Scripting.FileSystemObject");
                var filePath = $("#" + fileid)[0].value;
                var objFile = obaxo.getFile(filePath);
                var fileSize = objFile.size;
                fileSize = fileSize / 1048576;
            }
            else {
                fileSize = $(fileid)[0].files[0].size
                fileSize = fileSize / 1048576;
            }

            return fileSize;
        }
        catch (e) {
            alert("Error is :" + e);
        }
    }

    function getNameFromPath(strFilepath) {
        var objRE = new RegExp(/([^\/\\]+)$/);
        var strName = objRE.exec(strFilepath);

        if (strName == null) {
            return null;
        }
        else {
            return strName[0];
        }
    }

    function ValidateFile(value) {

        var file = getNameFromPath($(value).val());
        if (file != null) {
            var extension = file.substr((file.lastIndexOf('.') + 1)).toLowerCase();
            switch (extension) {
                case 'jpg':
                case 'jpeg':
                case 'png':
                    flag = true;
                    break;
                default:
                    flag = false;
            }
        }

        if (flag == false) {

            var str = value.name;
            //var res = str.split("-");
            var data = "_val" + str;
            $("#" + data).text("Bạn chỉ có thể chọn file có định dạng jpg, jpeg, png");
            $("#" + value.name).val('');
            return false;
        }
        else {
            var size = ValidateFileSize(value);
            var str = value.name;
            //var res = str.split("-");
            var data = "_val" + str;
            if (size > 1) {
                $("#" + data).text("Bạn chỉ có thể upload file kích thước tối đa là 1 MB.");
                $("#" + value.name).val('');
            }
            else {
                $("#" + data).text("");
            }
        }
    }
</script>