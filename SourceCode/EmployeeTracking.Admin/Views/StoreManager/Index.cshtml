@using PagedList.Mvc
@model PagedList.IPagedList<EmployeeTracking.Data.ModelCustom.StoreManagerModel>
@using System.Configuration;

@{
    ViewBag.Title = "StoreManager";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Quản lý cửa hàng</h2>

<div class="row">
    <div class="col-xs-12">
        <a class="btn btn-sm btn-success" onclick="addNew()">Thêm mới</a>
        <a class="btn btn-sm btn-info">Export Excel</a>
        <a class="btn btn-sm btn-info">Import Excel</a>
    </div>
</div>
<div class="row clearfix">
    <p></p>
</div>


<div class="row">
    <div class="col-xs-12">
        <div class="panel panel-default">
            <div class="panel-body">
                @using (Html.BeginForm("Index", "StoreManager", FormMethod.Get, new { id = "frmFilter" }))
                {
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="col-xs-12 col-sm-6 col-md-4">
                                <div class="form-group">
                                    <label class="control-label">Mã cửa hàng</label>
                                    <input type="text" class="form-control" name="code" value="@ViewBag.Code" />
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-4">
                                <div class="form-group">
                                    <label class="control-label">Tên cửa hàng</label>
                                    <input type="text" class="form-control" name="name" value="@ViewBag.Name" />
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-4">
                                <div class="form-group">
                                    <label class="control-label">Loại hình cửa hàng</label>
                                    <input type="text" class="form-control"name="storeType" value="@ViewBag.StoreType" />
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-4">
                                <div class="form-group">
                                    <label class="control-label">Số nhà</label>
                                    <input type="text" class="form-control" name="houseNumber" value="@ViewBag.HouseNumber" />
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-4">
                                <div class="form-group">
                                    <label class="control-label">Tên đường</label>
                                    <input type="text" class="form-control" name="streetName" value="@ViewBag.StreetName" />
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-4">
                                <div class="form-group">
                                    <label class="control-label">Tỉnh/Thành Phố</label>
                                    <input type="text" class="form-control" name="owner" value="@ViewBag.ProvinceId" />
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-4">
                                <div class="form-group">
                                    <label class="control-label">Quận/Huyện</label>
                                    <input type="text" class="form-control" name="districtId" value="@ViewBag.DistrictId" />
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-4">
                                <div class="form-group">
                                    <label class="control-label">Phường/Xã</label>
                                    <input type="text" class="form-control" name="wardId" value="@ViewBag.WardId" />
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-4">
                                <div class="form-group">
                                    <label class="control-label">Vùng</label>
                                    <input type="text" class="form-control" name="region" value="@ViewBag.Region" />
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-6 col-md-4">
                                <div class="form-group" style="margin-top:25px;">
                                    <button type="submit" class="btn btn-primary">Tìm kiếm</button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                <div class="row">
                    <div class="col-xs-12">
                        <table class="table table-bordered table-striped table-hover">
                            <thead style="font-weight:bold;">
                                <tr>
                                    <td>.No</td>
                                    <td>Mã cửa hàng</td>
                                    <td>Tên cửa hàng</td>
                                    <td>Loại hình cửa hàng</td>
                                    <td>Số nhà</td>
                                    <td>Tên đường</td>
                                    <td>Tỉnh/Thành Phố</td>
                                    <td>Quận/Huyện</td>
                                    <td>Phường/Xã</td>
                                    <td>Vùng</td>
                                    <td></td>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>@Html.DisplayFor(modelItem => item.Index)</td>
                                        <td>@Html.DisplayFor(modelItem => item.Code)</td>
                                        <td>@Html.DisplayFor(modelItem => item.Name)</td>
                                        <td>@Html.DisplayFor(modelItem => item.StoreTypeName)</td>
                                        <td>@Html.DisplayFor(modelItem => item.HouseNumber)</td>
                                        <td>@Html.DisplayFor(modelItem => item.StreetNames)</td>
                                        <td>@Html.DisplayFor(modelItem => item.ProvinceName)</td>
                                        <td>@Html.DisplayFor(modelItem => item.DistrictName)</td>
                                        <td>@Html.DisplayFor(modelItem => item.WardName)</td>
                                        <td>@Html.DisplayFor(modelItem => item.Region)</td>
                                        <td>
                                            <a class="btn btn-xs btn-info" onclick="btnUpdate_Click('@item.Id')">Chỉnh sửa</a>
                                            <a class="btn btn-xs btn-danger" onclick="btnDelete_Click('@item.Id')">Xóa</a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                        @Html.PagedListPager(Model, page => Url.Action("Index", new
                   {
                       page = page,
                       code = Request.QueryString["code"],
                       name = Request.QueryString["name"],
                       storeType = Request.QueryString["storeType"],
                       houseNumber = Request.QueryString["houseNumber"],
                       streetName = Request.QueryString["streetName"],
                       provinceId = Request.QueryString["provinceId"],
                       districtId = Request.QueryString["districtId"],
                       wardId = Request.QueryString["wardId"],
                       region = Request.QueryString["region"]
                   }), PagedListRenderOptions.PageNumbersOnly)
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Addnew-->
<div class="modal fade" id="myModalDetail" tabindex="-1" role="dialog" data-backdrop="static" style="display: none;">
    <div class="modal-dialog" role="document">
        <div id='modelContainer'></div>
    </div>
</div>

<script>
    $(function () {
        $("#myModalDetail").on("hidden.bs.modal", function () {
            refreshData();
        });
        $("#myModalDetail").on("shown.bs.modal", function () {
            $("frmDetail").find("span.field-validation-valid").hide();
        });
    });

    //Thêm thông tin.
    function addNew() {
        var url = '@Url.Action("GetDetail", "StoreManager")' + "?id=";

        $.get(url, function (data) {
            $('#modelContainer').html(data);
            $('#myModalDetail').modal('show');
        });
    }

    function btnUpdate_Click(id) {
        var url = '@Url.Action("GetDetail", "StoreManager")' + "?id=" + id;

        $.get(url, function (data) {
            $('#modelContainer').html(data);
            $('#myModalDetail').modal('show');
        });
    }

    function btnDelete_Click(id) {
        $.confirm({
            icon: 'fa fa-question-circle-o canhbao',
            closeIcon: true,
            height: 50,
            title: "Xác nhận",
            content: "Bạn muốn xóa cửa hàng này không?",
            columnClass: 'col-md-4 col-md-offset-4',
            confirmButton: 'Có',
            cancelButton: 'Không',
            confirm: function () {
                $.ajax({
                    url: '/StoreManager/DeleteModel',
                    type: "POST",
                    data: { id: id },
                    success: function (data) {
                        if (data.IsSuccess) {
                            refreshData();
                            //openFunc.pushNotifySuccess("Xóa cửa hàng thành công!");
                        }
                        else {
                            openFunc.pushNotifyError(data.Message);
                        }
                    }
                });
            },
            cancel: function () {

            }
        });
    }
    
    function refreshData()
    {
        $("#frmFilter").submit();
    }
</script>